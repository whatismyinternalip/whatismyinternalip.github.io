<!doctype html>
<html><head>
    <meta charset="utf-8">
    <title>Whatismyinternalip.com</title>
    <style>
body{
  text-align: center;
}
#byline {
  font-style: italic;
}
    </style>
</head><body>
Your internal IP is: <h1 id="iplist"></h1>
<br />
<br />
<p>Heavily inspired by <a href="https://2x.io/read/security-by-obscurity">this</a> and <a href="http://net.ipcalf.com/">this</a>.</p>
<p><a href="https://github.com/whatismyinternalip/whatismyinternalip.github.io">Fork me on Github.</a></p>
<p id="byline">Made by <a href="https://twitter.com/bengl">@bengl</a></p>



<script>
(function() {
  var RTCPeerConnection = window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
  var unavail = 'Not available. Try this:<br/><code>$ ifconfig | grep "inet " | cut -d " " -f2 | grep -v "^127.0"</code>';
  var ipElem = document.getElementById('iplist');

  if (!RTCPeerConnection) {
    ipElem.innerHTML = unavail;
    return;
  }

  var rtc = new RTCPeerConnection({iceServers:[]});
  if (window.mozRTCPeerConnection) {      // FF needs a channel/stream to proceed
    rtc.createDataChannel('', {reliable:false});
  };

  rtc.onicecandidate = function (evt) {
    if (evt.candidate) grepSDP(evt.candidate.candidate);
  };

  rtc.createOffer(function (offerDesc) {
    grepSDP(offerDesc.sdp);
    rtc.setLocalDescription(offerDesc);
  }, function (e) { console.warn("offer failed", e); });


  var addrs = [];
  function updateDisplay(newAddr) {
    if (~addrs.indexOf(newAddr)) return;
    else addrs.push(newAddr);
    console.log(addrs);
    var displayAddrs = addrs.filter(function (k) {
      var nums = k.split('.').map(function(i){return parseInt(i, 10)});
      if (nums[0] === 10) return true;
      if (nums[0] === 172 && nums[1] >= 16 && nums[1] <= 31) return true;
      if (nums[0] === 192 && nums[1] === 168) return true;
      return false;
    });
    console.log(displayAddrs);
    ipElem.innerHTML = displayAddrs.join(" or perhaps ") || '...';
  }
    
  function grepSDP(sdp) {
    sdp.split('\r\n').forEach(function (line) {
      console.log(line);
      if (~line.indexOf("a=candidate")) {
        var parts = line.split(' ');
        if (parts[7] === 'host') updateDisplay(parts[4]);
      } else if (~line.indexOf("c=")) {
        updateDisplay(line.split(' ')[2]);
      }
    });
  }
})();
</script>

</body></html>
